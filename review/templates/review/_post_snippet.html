<div class="post-block your-flux">
    <h2 class="scrollable-title">Vôtre Flux Personnel</h2>
    <button>
        <a href="{% url 'create_ticket' %}">Créer un ticket</a>
    </button>
    <button>
        <a href="{% url 'create_article' %}">Créer un article</a>
    </button>
    {% for ticket in user_tickets %}
        <div class="ticket-block">
            {% for critique in user_reviews_in_followed_tickets %}
                {% if critique.ticket == ticket %}
                    <div class="critique-block">
                        <p>{{ critique.user.username }} a créé une critique </p>
                        <h4>Critique</h4>
                        <p>Titre de la critique: {{ critique.title }}</p>
                        <p>Auteur de la critique: {{ critique.user.username }}</p>
                        <p>Description de la critique: {{ critique.description|linebreaksbr }}</p>
                        <p>Date de création de la critique: {{ critique.created_at }}</p>
                        <p>Score du ticket: {{ critique.get_star_rating }}</p>
                    </div>
                {% endif %}
            {% endfor %}
            <p>Vous avez publié un ticket [{{ ticket.creator }}]</p>
            <h3>Titre du ticket: {{ ticket.title }}</h3>
            <p>Description: {{ ticket.description|linebreaksbr }}</p>
            <img src="{{ ticket.image.url }}" alt="Ticket Image">
            <p>Date de création du ticket: {{ ticket.created_at }}</p>
            {% if ticket.creator == user %}
                <form method="post" action="{% url 'update_ticket' ticket.pk %}">
                    {% csrf_token %}
                    <button type="submit">Modifier le ticket</button>
                </form>
                <form method="post" action="{% url 'delete_ticket' ticket.pk %}">
                    {% csrf_token %}
                    <button type="submit">Supprimer le ticket</button>
                </form>
            {% endif %}
            <!-- Afficher les critiques du ticket complet -->
            {% for critique in ticket.reviews.all %}
                {% if critique.user == user %}
                    <div class="critique-block">
                        <p>{{ critique.user.username }} a crée une critique </p>
                        <h4>Critique</h4>
                        <p>Titre de la critique: {{ critique.title }}</p>
                        <p>Auteur de la critique: {{ critique.user.username }}</p>
                        <p>Description de la critique: {{ critique.description|linebreaksbr }}</p>
                        <p>Date de création de la critique: {{ critique.created_at }}</p>
                        <p>Score du ticket: {{ critique.get_star_rating }}</p>
                        <form method="post" action="{% url 'update_review' critique.pk %}">
                            {% csrf_token %}
                            <button type="submit">Modifier la critique</button>
                        </form>
                        <form method="post" action="{% url 'delete_review' critique.pk %}">
                            {% csrf_token %}
                            <button type="submit">Supprimer la critique</button>
                        </form>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
    <!-- Afficher les tickets associés aux critiques des utilisateurs suivis -->
    {% for ticket in followed_tickets_with_user_critiques %}
        {% if ticket.pk in ticket_ids_with_reviews %}
            <div class="ticket-block">
                <p>Ticket - [{{ ticket.creator }}]</p>
                <h3>Titre du ticket: {{ ticket.title }}</h3>
                <p>Description: {{ ticket.description|linebreaksbr }}</p>
                <img src="{{ ticket.image.url }}" alt="Ticket Image">
                <p>Date de création du ticket: {{ ticket.created_at }}</p>
                {% if ticket.creator == user %}
                    <form method="post" action="{% url 'update_ticket' ticket.pk %}">
                        {% csrf_token %}
                        <button type="submit">Modifier le ticket</button>
                    </form>
                    <form method="post" action="{% url 'delete_ticket' ticket.pk %}">
                        {% csrf_token %}
                        <button type="submit">Supprimer le ticket</button>
                    </form>
                {% endif %}
                <!-- Afficher les critiques de l'utilisateur connecté associées au ticket de l'utilisateur suivit -->
                {% for critique in ticket.reviews.all %}
                    {% if critique.user == user or critique.ticket.creator == user %}
                        <div class="critique-block">
                            <p>{{ critique.user.username }} a crée une critique </p>
                            <h4>Critique</h4>
                            <p>Titre de la critique: {{ critique.title }}</p>
                            <p>Auteur de la critique: {{ critique.user.username }}</p>
                            <p>Description de la critique: {{ critique.description|linebreaksbr }}</p>
                            <p>Date de création de la critique: {{ critique.created_at }}</p>
                            <p>Score du ticket: {{ critique.get_star_rating }}</p>
                            {% if critique.user == user %}
                                <form method="post" action="{% url 'update_review' critique.pk %}">
                                    {% csrf_token %}
                                    <button type="submit">Modifier la critique</button>
                                </form>
                                <form method="post" action="{% url 'delete_review' critique.pk %}">
                                    {% csrf_token %}
                                    <button type="submit">Supprimer la critique</button>
                                </form>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    {% endfor %}
</div>